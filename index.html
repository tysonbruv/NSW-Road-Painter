<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sydney Road Painter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
  margin: 0;
  height: 100%;
  background: #000;
  font-family: system-ui, sans-serif;
}

#map {
  width: 100%;
  height: 100%;
}

.info {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(20,20,20,0.9);
  color: #fff;
  padding: 10px 14px;
  border-radius: 10px;
  z-index: 1000;
  font-size: 13px;
}

.reset {
  position: absolute;
  top: 12px;
  right: 12px;
  background: #ff7a18;
  color: #000;
  border: none;
  padding: 8px 14px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  z-index: 1000;
}
</style>
</head>
<body>

<div id="map"></div>

<div class="info">
  <strong>Sydney Road Painter</strong>
  <div id="status">Loading Sydney roads…</div>
</div>

<button class="reset" onclick="resetTrail()">Reset</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// =====================
// MAP
// =====================
const map = L.map('map', {
  zoomControl: false,
  attributionControl: false,
  minZoom: 10,
  maxZoom: 18
}).setView([-33.87, 151.21], 13);

// Dark basemap (land + water)
L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
  { subdomains: 'abcd' }
).addTo(map);

// =====================
// SYDNEY ROADS (BLUE)
// =====================
const roadsLayer = L.layerGroup().addTo(map);

// Small Sydney bounding box (IMPORTANT)
const bbox = "-33.95,151.05,-33.80,151.30";

const overpassURL =
  "https://overpass-api.de/api/interpreter?data=" +
  encodeURIComponent(`
[out:json];
way["highway"](${bbox});
out geom;
`);

fetch(overpassURL)
  .then(r => r.json())
  .then(data => {
    data.elements.forEach(el => {
      if (!el.geometry) return;

      const pts = el.geometry.map(p => [p.lat, p.lon]);
      L.polyline(pts, {
        color: "#2f80ff",
        weight: 2,
        opacity: 1
      }).addTo(roadsLayer);
    });

    document.getElementById("status").textContent = "Painting roads…";
  })
  .catch(() => {
    document.getElementById("status").textContent = "Road load failed";
  });

// =====================
// ORANGE USER + TRAIL
// =====================
const trailLayer = L.layerGroup().addTo(map);

let userMarker = L.rectangle([[0,0],[0,0]], {
  color: "#ff7a18",
  weight: 0,
  fillOpacity: 1
}).addTo(map);

function drawUser(latlng) {
  const size = 0.00025;

  const bounds = [
    [latlng.lat - size, latlng.lng - size],
    [latlng.lat + size, latlng.lng + size]
  ];

  userMarker.setBounds(bounds);

  L.rectangle(bounds, {
    color: "#ff7a18",
    weight: 0,
    fillOpacity: 1
  }).addTo(trailLayer);
}

// =====================
// GPS
// =====================
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(
    pos => {
      const latlng = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude
      };

      map.setView(latlng, 17);
      drawUser(latlng);
    },
    () => {
      document.getElementById("status").textContent =
        "Location permission denied";
    },
    { enableHighAccuracy: true }
  );
}

// =====================
// RESET
// =====================
function resetTrail() {
  trailLayer.clearLayers();
}
</script>

</body>
</html>
